<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>البحث عن الملابس</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family:'Segoe UI',sans-serif; background:#f0f0f0; margin:0; padding:20px }
    header { background:#2196F3; color:#fff; padding:10px; text-align:center; border-radius:8px }
    .search-box { display:flex; justify-content:center; gap:10px; margin:20px 0 }
    .search-box input { flex:1; padding:10px; font-size:16px; border:1px solid #ccc; border-radius:5px }
    .search-box button { padding:10px 20px; background:#2196F3; color:#fff; border:none; border-radius:5px; cursor:pointer }
    table { width:100%; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden }
    th, td { padding:12px; border-bottom:1px solid #ddd; text-align:center }
    th { background:#f2f2f2 }
    img { max-height:80px }
  </style>
</head>
<body>

<header>البحث عن الملابس</header>

<div class="search-box">
  <input id="searchInput" type="text" placeholder="اكتب رقم التعريف أو القياس...">
  <button id="resetBtn">إعادة تعيين</button>
</div>

<table>
  <thead>
    <tr>
      <th>الرقم</th><th>الاسم</th><th>الصورة</th><th>القياسات</th><th>السعر</th>
    </tr>
  </thead>
  <tbody id="tableBody"></tbody>
</table>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycbwK-ocQW5eO9n0_8qKy2o34dVjFT2Qyb2vE5HWVIoAU6KrwqwbcDiVT8dhmXOtGs3eEBw/exec';
  let data = [];

  async function fetchData() {
    try {
      const resp = await fetch(API_URL);
      data = await resp.json();
      filterAndDisplay();
    } catch (e) {
      console.error('خطأ في جلب البيانات:', e);
      document.getElementById('tableBody').innerHTML = 
        "<tr><td colspan='5'>فشل في تحميل البيانات</td></tr>";
    }
  }

  function filterAndDisplay() {
    const term = document.getElementById('searchInput')
                     .value.trim().toLowerCase();
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';

    
    const idKey = data.length
      ? Object.keys(data[0]).find(k => k.toLowerCase()==='id')
      : 'id';

    const filtered = data.filter(item => {
      const idVal   = (item[idKey] || '').toString().toLowerCase();
      const sizesVal= (item.sizes || item.Sizes || '').toLowerCase();
      return term === '' ||
             idVal.includes(term) ||
             sizesVal.includes(term);
    });

    if (!filtered.length) {
      tbody.innerHTML = "<tr><td colspan='5'>لا توجد نتائج.</td></tr>";
      return;
    }

    tbody.innerHTML = filtered.map(item => {
      const idVal    = item[idKey] || '';
      const nameVal  = item.name  || item.Name || '';
      const picVal   = item.picture|| item.Picture || '';
      const sizesVal = item.sizes || item.Sizes || '';
      const priceVal = item.price || item.Price || '';
      return `
        <tr>
          <td>${idVal}</td>
          <td>${nameVal}</td>
          <td><img src="${picVal}" alt></td>
          <td>${sizesVal}</td>
          <td>${priceVal}</td>
        </tr>`;
    }).join('');
  }

  document.getElementById('searchInput')
    .addEventListener('input', filterAndDisplay);

  document.getElementById('resetBtn')
    .addEventListener('click', () => {
      document.getElementById('searchInput').value = '';
      filterAndDisplay();
    });

  fetchData();
  setInterval(fetchData, 30000);   
</script>

</body>
</html>
